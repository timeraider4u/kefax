<project name="BuildAntlr4" default="init" basedir=".">
	<description>
		Build ANTLR4 src-gen files (lexer, parser, etc. 
		for ANTLR4 grammar files)
	</description>
	
	<!-- set global properties for this build -->
	<property name="script_dir" value="${basedir}" />
	<property name="script" value="${ant.file}" />
	<property name="my_dir" location="${script_dir}/../../../../../" />
	<fileset id="lib.fileset" dir="${my_dir}/lib" includes="**/antlr4*.jar"/>
	<property name="pkg_dir" value="org/antlr/parser/antlr4" />
	<property name="pkg_name" value="org.antlr.parser.antlr4" />
	<property name="tool" value="org.antlr.v4.Tool" />
	<property name="src_dir1" value="${my_dir}/src/${pkg_dir}" />
	<property name="src_dir2" value="${my_dir}/src-gen/${pkg_dir}" />
	
	<property name="lexer1" value="${src_dir1}/LexBasic.g4" />
	<property name="lexer2" value="${src_dir1}/ANTLRv4Lexer.g4" />
	<property name="parser" value="${src_dir1}/ANTLRv4Parser.g4" />
	
	<property name="encoding" value="UTF-8" />
	
	<target name="init">
		<!--
		<echo>${user.dir}</echo>
		<echo>${my_dir}</echo>
		-->
		<pathconvert property="lib.file" refid="lib.fileset" />
		<!-- <echo message="found : ${lib.file}"/> -->
		<delete dir="${src_dir2}" failonerror="false" />
		<mkdir dir="${src_dir2}" />
		<!--
		<antcall target="runAntlr4Tool">
			<param name="file" value="${lexer1}"/>
		</antcall>
		-->
		<antcall target="runAntlr4Tool">
			<param name="file" value="${lexer2}"/>
			<param name="lib.file" value="${lib.file}" />
		</antcall>
		<antcall target="runAntlr4Tool">
			<param name="file" value="${parser}"/>
			<param name="lib.file" value="${lib.file}" />
		</antcall>
	</target>
	
	<target name="runAntlr4Tool">
		<echo message="file='${file}'" />
		<echo message="lib.file='${lib.file}'" />
		<java dir="${src_dir2}" classname="${tool}"
			fork="true"
			failonerror="true">
			<arg value="${file}"/>
			<arg value="-o" />
			<arg value="${src_dir2}" />
			<arg value="-package" />
			<arg value="${pkg_name}" />
			<arg value="-encoding" />
			<arg value="${encoding}" />
			<arg value="-listener" />
			<arg value="-no-visitor" />
			<!-- <arg value="-incTokenInVisit" />-->
			
			<classpath>
				<pathelement location="${lib.file}"/>				
				<pathelement location="${src_dir1}" />
				<pathelement location="${src_dir2}" />

			</classpath>
		</java>
	</target>
	
</project>
