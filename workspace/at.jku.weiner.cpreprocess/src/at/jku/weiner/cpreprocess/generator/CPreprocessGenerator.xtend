/*
 * generated by Xtext 2.9.0-SNAPSHOT
 */
package at.jku.weiner.cpreprocess.generator

import org.eclipse.emf.ecore.resource.Resource
import org.eclipse.xtext.generator.IFileSystemAccess
import org.eclipse.xtext.generator.IGenerator
import org.eclipse.xtend.lib.annotations.Accessors
import at.jku.weiner.cpreprocess.cPreprocess.TranslationUnit
import at.jku.weiner.cpreprocess.cPreprocess.Model
import at.jku.weiner.cpreprocess.cPreprocess.PreprocessorDirectives
import at.jku.weiner.cpreprocess.cPreprocess.NewLineLine
import at.jku.weiner.cpreprocess.cPreprocess.Code
import at.jku.weiner.cpreprocess.cPreprocess.IncludeDirective
import at.jku.weiner.cpreprocess.cPreprocess.DefineDirective
import at.jku.weiner.cpreprocess.cPreprocess.UnDefineDirective
import at.jku.weiner.cpreprocess.cPreprocess.ErrorDirective
import at.jku.weiner.cpreprocess.cPreprocess.PragmaDirective

/**
 * Generates code from your model files on save.
 * 
 * See https://www.eclipse.org/Xtext/documentation/303_runtime_concepts.html#code-generation
 */
class CPreprocessGenerator implements IGenerator {

	@Accessors String fileName = 'greetings.txt';
	
	override void doGenerate(Resource input, IFileSystemAccess fsa) {
		val model = input.allContents.filter(typeof(Model)).head;
		val unit = model.units.head;
		val output = outputFor(unit);
		fsa.generateFile(fileName, output);
	}

	def String outputFor(TranslationUnit unit) '''
		«FOR l : unit.lines»
			«IF l instanceof PreprocessorDirectives»
				«outputFor(l as PreprocessorDirectives)»
			«ENDIF»
			«IF l instanceof NewLineLine»
				«outputFor(l as NewLineLine)»
			«ENDIF»
			«IF l instanceof Code»
				«outputFor(l as Code)»
			«ENDIF»
		«ENDFOR»
	'''

	def String outputFor(PreprocessorDirectives obj) '''
		«IF obj.directive instanceof IncludeDirective»
			«outputFor(obj.directive as IncludeDirective)»
		«ENDIF»
		«IF obj.directive instanceof DefineDirective»
			«outputFor(obj.directive as DefineDirective)»
		«ENDIF»
		«IF obj.directive instanceof UnDefineDirective»
			«outputFor(obj.directive as UnDefineDirective)»
		«ENDIF»
		«IF obj.directive instanceof ErrorDirective»
			«outputFor(obj.directive as ErrorDirective)»
		«ENDIF»
		«IF obj.directive instanceof PragmaDirective»
			«outputFor(obj.directive as PragmaDirective)»
		«ENDIF»
	'''
	
	def String outputFor(IncludeDirective obj) {
		return "";
	}
	
	def String outputFor(DefineDirective obj) {
		return "";
	}
	
	def String outputFor(UnDefineDirective obj) {
		return "";
	}
	
	def String outputFor(ErrorDirective obj) '''
	'''
	
	def String outputFor(PragmaDirective obj) '''
	'''
	
	def String outputFor(NewLineLine obj) '''

	'''
	
	def String outputFor(Code obj) {
		val String code = obj.code.toString();
		return code;
	}
	
}
